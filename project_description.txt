ОПИСАНИЕ ПРОЕКТА: RAG-СИСТЕМА ДЛЯ ПОИСКА ПО БАЗЕ ИНСТРУКЦИЙ
================================================================

1. ИДЕЯ ПРОЕКТА
---------------
Разработка локальной RAG-системы (Retrieval-Augmented Generation) для автоматизации
работы технической поддержки. Система позволяет сотрудникам быстро находить решения
проблем в корпоративной базе знаний, используя семантический поиск и генерацию
естественноязычных ответов.

Основная проблема: сотрудники техподдержки тратят много времени на поиск инструкций
в большой базе документов. Традиционный текстовый поиск не работает, если пользователь
формулирует запрос иными словами, чем в документе.

Решение: использование нейронных сетей для понимания смысла запроса и поиска
релевантных документов по семантическому сходству, а не по точному совпадению слов.


2. ЗАДАЧИ, КОТОРЫЕ РЕШАЕТ ПРОЕКТ
---------------------------------
- Семантический поиск по базе инструкций (поиск по смыслу, а не по ключевым словам)
- Автоматическая обработка документов различных форматов (.docx, .md, .txt)
- Генерация развернутых ответов на вопросы пользователей на основе найденных документов
- Предоставление ссылок на источники информации для верификации ответов
- Управление базой знаний (добавление, редактирование, удаление документов)
- Полностью локальная работа без передачи данных в облако (важно для конфиденциальности)


3. СУЩЕСТВУЮЩИЕ АНАЛОГИ
-----------------------
- ChatGPT с загрузкой файлов - требует интернет, данные уходят на сервера OpenAI
- Elastic Search - классический текстовый поиск, не понимает семантику
- Confluence/Wiki - требует ручную навигацию и точное знание терминов
- Microsoft SharePoint Search - работает по ключевым словам, не понимает контекст

Преимущества нашего решения:
+ Полностью локальное (конфиденциальность корпоративных данных)
+ Понимание смысла запроса (семантический поиск)
+ Генерация готовых ответов (не нужно читать весь документ)
+ Низкая стоимость (бесплатные open-source модели)
+ Возможность кастомизации под специфику компании


4. ЦЕЛЕВАЯ АУДИТОРИЯ
--------------------
- Сотрудники технической поддержки (первая линия)
- Администраторы систем 1С
- Инженеры поддержки кассового оборудования
- Новые сотрудники (для быстрого обучения)
- Руководители отделов техподдержки (для мониторинга частых проблем)


5. ОПИСАНИЕ АРХИТЕКТУРЫ НЕЙРОННОЙ СЕТИ
---------------------------------------

5.1. Модель эмбеддингов (Encoder)
Используется: intfloat/multilingual-e5-small
Архитектура: Transformer-based encoder (BERT-подобная архитектура)
Параметры: ~118M параметров
Размерность векторов: 384

Принцип работы:
- Преобразует текст в векторное представление фиксированной размерности
- Семантически похожие тексты имеют близкие векторы (высокое косинусное сходство)
- Обучена на многоязычном корпусе с контрастивным обучением

Обоснование выбора:
+ Поддержка русского языка (multilingual)
+ Компактный размер (работает на CPU без GPU)
+ Высокое качество эмбеддингов для поисковых задач
+ Оптимизирована специально для retrieval задач (e5 = Embeddings from bidirectional Encoder representations)

5.2. Языковая модель (Generator)
Используется: llama3:8b через Ollama
Архитектура: Decoder-only Transformer (GPT-подобная архитектура)
Параметры: ~8B параметров
Контекстное окно: 8192 токенов

Принцип работы:
- Принимает на вход контекст (найденные документы) + запрос пользователя
- Генерирует естественноязычный ответ на основе предоставленного контекста
- Использует autoregressive generation (предсказывает следующий токен)

Обоснование выбора:
+ Работает локально через Ollama (не нужен API ключ)
+ Хорошее понимание русского языка
+ Достаточный размер для качественных ответов, но работает на consumer GPU
+ Поддержка инструкций (instruction-tuned модель)

5.3. Векторная база данных
Используется: ChromaDB
Индексация: HNSW (Hierarchical Navigable Small World)

Принцип работы:
- Хранит векторные представления текстовых чанков
- Быстрый approximate nearest neighbor search (ANN)
- Поддержка метаданных и фильтрации

5.4. Гибридный поиск
Используется: Комбинация векторного поиска + BM25
- Векторный поиск: находит семантически похожие документы
- BM25: статистический алгоритм, хорош для точного совпадения терминов
- Объединение результатов через взвешенное ранжирование


6. СТРАТЕГИЯ ОБУЧЕНИЯ
---------------------

6.1. Transfer Learning подход
Проект НЕ обучает модели с нуля, а использует предобученные модели:
- Модель эмбеддингов: предобучена на задаче retrieval
- LLM: предобучена на большом текстовом корпусе + instruction tuning

Обоснование:
- Обучение с нуля требует огромных вычислительных ресурсов
- Предобученные модели уже понимают язык и семантику
- Достаточно адаптировать через промпт-инжиниринг

6.2. Адаптация под задачу
Вместо fine-tuning используется:

a) Промпт-инжиниринг для LLM:
   - Системный промпт инструктирует модель отвечать только на основе контекста
   - Структурированный формат подачи контекста
   - Явное указание использовать только предоставленную информацию

b) Оптимизация параметров чанкинга:
   - Размер чанка: 500 токенов (~2000 символов)
   - Перекрытие: 50 токенов (10%)
   - Обоснование: баланс между сохранением контекста и точностью поиска

c) Настройка поискового пайплайна:
   - TOP_K = 3-5 документов
   - Фильтрация по метаданным (только активные документы)
   - Гибридный поиск для повышения релевантности

6.3. Процесс индексации (подготовка данных)
1. Парсинг документов (.docx, .md, .txt)
2. Извлечение текста и изображений
3. Добавление заголовка документа в начало каждого чанка (для контекста)
4. Разбиение на перекрывающиеся чанки
5. Генерация эмбеддингов для каждого чанка
6. Сохранение в векторную БД с метаданными

6.4. Процесс инференса (во время запроса)
1. Получение запроса пользователя
2. Генерация эмбеддинга запроса
3. Векторный поиск TOP_K похожих чанков
4. Формирование контекста из найденных чанков
5. Передача в LLM: system prompt + context + user query
6. Генерация ответа
7. Возврат ответа + ссылки на источники


7. ТЕХНИЧЕСКИЕ ДЕТАЛИ РЕАЛИЗАЦИИ
---------------------------------

7.1. Используемые библиотеки:
- sentence-transformers: работа с эмбеддинг моделями
- chromadb: векторная база данных
- langchain: оркестрация RAG пайплайна
- streamlit: веб-интерфейс
- ollama: запуск локальных LLM
- python-docx: парсинг Word документов

7.2. Архитектура кода (модульная):
- src/embeddings.py - работа с эмбеддинг моделью
- src/storage.py - управление ChromaDB
- src/docs_parser.py - парсинг документов
- src/chunker.py - разбиение на чанки
- src/llm_client.py - интеграция с Ollama
- src/rag_pipeline.py - основная логика RAG
- src/app.py - Streamlit интерфейс

7.3. Конфигурация:
EMBEDDING_MODEL_NAME = "intfloat/multilingual-e5-small"
CHUNK_SIZE_TOKENS = 500
CHUNK_OVERLAP_TOKENS = 50
TOP_K = 5
LLM_MODEL_NAME = "llama3:8b"
LLM_MAX_TOKENS = 512


8. ИНТЕГРАЦИЯ В ПОЛЬЗОВАТЕЛЬСКИЙ ПРОДУКТ
-----------------------------------------
Реализован веб-интерфейс на Streamlit с тремя основными разделами:

8.1. Поиск (основной функционал):
- Поле ввода запроса
- Настройка количества результатов (TOP_K)
- Отображение сгенерированного ответа
- Список источников с оценкой релевантности
- Возможность просмотра исходных чанков

8.2. Загрузка документов:
- File uploader для .docx, .md, .txt
- Указание метаданных (автор, теги)
- Автоматическая обработка и индексация
- Обратная связь о прогрессе обработки

8.3. База знаний (в разработке):
- Просмотр всех документов
- Удаление документов
- Пометка как неактуальных
- Редактирование метаданных


9. РЕЗУЛЬТАТЫ ТЕСТИРОВАНИЯ
--------------------------
Проведено тестирование на 4 типичных запросах техподдержки:

Тест 1: "Загрузка справочников вручную"
Результат: ✅ Найден правильный документ, ответ корректный
Проблема: Пропущено одно важное предложение между картинками

Тест 2: "Переустановка гостов"
Результат: ❌ Документ в базе есть, но не найден
Проблема: В запросе нет релевантных слов из документа (проблема синонимов)

Тест 3: "Загрузка закупов на магазин вручную"
Результат: ✅ Найден правильный документ, ответ в целом верный
Проблема: Добавлены лишние предложения, которые могут запутать

Тест 4: "Ошибка ккм 409"
Результат: ⚠️ Частично корректно
Проблема: В документе всего 1 строка с ответом, модель её не нашла

Общая точность: ~60-70%


10. ВЫЯВЛЕННЫЕ ПРОБЛЕМЫ И ПЛАНЫ УЛУЧШЕНИЯ
------------------------------------------

Текущие проблемы:
1. Парсинг не обрабатывает заголовки документов должным образом
2. Картинки теряются при разбиении на чанки
3. Синонимы и специфичные термины не распознаются
4. Короткие инструкции (1-2 предложения) теряются в чанках

Планируемые улучшения:
1. Добавить обработку заголовков и их включение в метаданные
2. Реализовать извлечение и привязку изображений к чанкам
3. Создать словарь синонимов и аббревиатур (ДДС, ДК, RW и т.д.)
4. Добавить теги/категории для документов (ЕГАИС, 1С)
5. Улучшить качество чанкинга (уважать границы смысловых блоков)
6. Заменить модель эмбеддингов на более крупную для улучшения качества
7. Добавить возможность редактирования и удаления документов
8. Реализовать версионирование документов


11. СРАВНЕНИЕ С АНАЛОГАМИ
--------------------------

+------------------+----------------+----------------+----------------+
| Характеристика   | Наш проект     | ChatGPT        | Elastic Search |
+------------------+----------------+----------------+----------------+
| Локальность      | ✅ Полностью   | ❌ Облачный    | ✅ Можно       |
| Конфиденциальность| ✅ Высокая    | ❌ Низкая      | ✅ Высокая     |
| Семантический    | ✅ Да          | ✅ Да          | ❌ Нет         |
| поиск            |                |                |                |
| Генерация        | ✅ Да          | ✅ Да          | ❌ Нет         |
| ответов          |                |                |                |
| Стоимость        | ✅ Бесплатно   | ❌ $20/мес     | ⚠️ Сложно      |
| Настройка под    | ✅ Легко       | ⚠️ Ограничена  | ✅ Гибко       |
| предметную       |                |                |                |
| область          |                |                |                |
| Работа без       | ✅ Да          | ❌ Нет         | ✅ Да          |
| интернета        |                |                |                |
| Русский язык     | ✅ Отлично     | ✅ Отлично     | ⚠️ Хорошо      |
+------------------+----------------+----------------+----------------+


12. ВЫВОДЫ
----------
Разработанная RAG-система успешно решает задачу семантического поиска по корпоративной
базе знаний и генерации ответов на вопросы техподдержки.

Ключевые достижения:
✅ Полностью локальное решение (конфиденциальность данных)
✅ Понимание смысла запросов (не только ключевые слова)
✅ Автоматическая генерация ответов
✅ Модульная архитектура (легко расширять)
✅ Удобный веб-интерфейс

Текущие ограничения:
⚠️ Точность ~60-70% (требуется улучшение парсинга и чанкинга)
⚠️ Не обрабатываются изображения
⚠️ Проблемы с синонимами и техническими терминами

Система готова к практическому использованию и дальнейшему улучшению на основе
обратной связи от пользователей.


================================================================
АВТОР: Ринат
ДАТА: Ноябрь 2024
ТЕХНОЛОГИИ: Python, Streamlit, ChromaDB, Sentence Transformers, Llama3, Ollama
ЛИЦЕНЗИЯ: Учебный проект
================================================================
